 <!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Продуктовый магазин - Экономический симулятор</title>
    <style>
        /* ... существующие стили ... */
        
        /* Кнопки умений */
        .skills-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            max-width: 400px;
            z-index: 10;
        }
        
        .skill-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px;
            font-size: 12px;
            border-radius: 10px;
            cursor: pointer;
            width: 70px;
            height: 70px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .skill-btn:hover:not(:disabled) {
            transform: scale(1.1);
            background: #45a049;
        }
        
        .skill-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .skill-icon {
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .skill-name {
            font-size: 9px;
            line-height: 1.1;
            text-align: center;
        }
        
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- ... существующая разметка ... -->
    
    <!-- Контейнер для умений -->
    <div class="skills-container" id="skillsContainer">
        <!-- Умения будут загружены через JavaScript -->
    </div>

    <script src="js/character.js"></script>
    <script src="js/opponents-data.js"></script>
    <script src="js/skills-data.js"></script>
    <script>
        // Загружаем сохраненные умения
        function loadPlayerSkills() {
            const savedSkills = localStorage.getItem('playerSkills');
            if (savedSkills) {
                const parsedSkills = JSON.parse(savedSkills);
                // Обновляем наш массив skills сохраненными данными
                parsedSkills.forEach(savedSkill => {
                    const skillIndex = skills.findIndex(s => s.id === savedSkill.id);
                    if (skillIndex !== -1) {
                        skills[skillIndex] = { ...skills[skillIndex], ...savedSkill };
                    }
                });
            }
            return skills.filter(skill => skill.equipped);
        }

        let currentOpponent = null;
        let playerSkills = [];
        const skillCooldowns = {};
        
        function displaySkills() {
            const skillsContainer = document.getElementById('skillsContainer');
            skillsContainer.innerHTML = '';
            
            playerSkills.forEach(skill => {
                const button = document.createElement('button');
                button.className = 'skill-btn';
                button.id = `skill-${skill.id}`;
                button.innerHTML = `
                    <div class="skill-icon">${skill.icon}</div>
                    <div class="skill-name">${skill.name}</div>
                `;
                
                button.onclick = () => performSkill(skill.id);
                skillsContainer.appendChild(button);
                
                updateSkillButton(skill.id);
            });
        }
        
        function performSkill(skillId) {
            if (!currentOpponent) return;
            
            const skill = playerSkills.find(s => s.id === skillId);
            if (!skill) return;
            
            // Проверяем cooldown
            if (skillCooldowns[skill.id] && skillCooldowns[skill.id] > Date.now()) {
                return;
            }
            
            // Проверяем достаточно ли выносливости
            if (character.endurance < skill.enduranceCost) {
                alert("Недостаточно выносливости!");
                return;
            }
            
            // Тратим выносливость
            character.endurance -= skill.enduranceCost;
            if (character.endurance < 0) character.endurance = 0;
            
            const success = Math.random() <= skill.successChance;

            if (success) {
                currentOpponent.health -= skill.power;
                if (currentOpponent.health < 0) currentOpponent.health = 0;
            } else {
                currentOpponent.health += 20;
                if (currentOpponent.health > currentOpponent.maxHealth) {
                    currentOpponent.health = currentOpponent.maxHealth;
                }
            }

            // Устанавливаем cooldown (3-5 секунд в зависимости от силы умения)
            const cooldown = 3000 + (skill.power * 100); // Базовые 3 секунды + доп время за силу
            skillCooldowns[skill.id] = Date.now() + cooldown;

            updateUI();
            checkGameEnd();
            updateSkillButton(skill.id);
        }
        
        function updateSkillButton(skillId) {
            const button = document.getElementById(`skill-${skillId}`);
            const skill = playerSkills.find(s => s.id === skillId);
            
            if (!button) return;
            
            // Убираем старый cooldown overlay
            const oldOverlay = button.querySelector('.cooldown-overlay');
            if (oldOverlay) {
                oldOverlay.remove();
            }
            
            if (skillCooldowns[skill.id] && skillCooldowns[skill.id] > Date.now()) {
                button.disabled = true;
                
                // Добавляем overlay с отсчетом времени
                const overlay = document.createElement('div');
                overlay.className = 'cooldown-overlay';
                const remaining = Math.ceil((skillCooldowns[skill.id] - Date.now()) / 1000);
                overlay.textContent = remaining;
                button.appendChild(overlay);
            } else {
                button.disabled = false;
            }
            
            // Проверяем достаточно ли выносливости для использования
            if (character.endurance < skill.enduranceCost) {
                button.style.opacity = '0.5';
            } else {
                button.style.opacity = '1';
            }
        }
        
        function updateAllSkillButtons() {
            playerSkills.forEach(skill => {
                updateSkillButton(skill.id);
            });
        }
        
        // Обновляем кнопки каждую секунду
        setInterval(updateAllSkillButtons, 1000);
        
        // Инициализация игры
        function initGame() {
            playerSkills = loadPlayerSkills();
            selectRandomOpponent();
            displaySkills();
        }
        
        // Запускаем игру
        initGame();
        
        // ... остальные функции (selectRandomOpponent, updateUI, checkGameEnd и т.д.)
    </script>
</body>
</html>